---
sidebar_position: 2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

import PackageJs from '!!raw-loader!{{CODE_PATH}}/js/simple-tutorial/generate-packages/my-package.js';
import IndexJs from '!!raw-loader!{{CODE_PATH}}/js/simple-tutorial/generate-packages/index.js';
import PodYaml from '!!raw-loader!{{CODE_PATH}}/js/simple-tutorial/generate-packages/output/manifests/custom-app/pod.yaml';

# Generating Packages

Simplest way to generate a package with Anemos is to define a function that takes a builder and an optional
options object in a JavaScript file. This function can then be used to generate Kubernetes manifests. It is
also possible to create an NPM package with multiple files, but this is not the focus of this tutorial.

Let's create a file named `my-package.js` with the following content:

<CodeBlock language="javascript" title="my-package.js" showLineNumbers>
    {PackageJs}
</CodeBlock>

## Explanation

<CodeBlock language="javascript" title="my-package.js" showLineNumbers>
    {PackageJs.split('\n').slice(0, 1).join('\n')}
</CodeBlock>

This line defines a function that takes a `builder` and an `options` object. Users will call this function
to generate manifests. Anemos will also call this function when package is applied directly to a cluster
with `anemos apply` command.

<CodeBlock language="javascript" title="index.js" showLineNumbers={2}>
    {PackageJs.split('\n').slice(1, 6).join('\n')}
</CodeBlock>

Users may or may not provide an `options` object or the values in it. We set default values for the
options that users do not provide.

<CodeBlock language="javascript" title="my-package.js" showLineNumbers={8}>
    {PackageJs.split('\n').slice(7, 26).join('\n').replace('    name,', '//highlight-next-line\n    name,')}
</CodeBlock>

This code snippet is similar to the one we used in the previous section. The only difference is that we
pass the `name` as the `documentGroup` parameter to the `addDocument` method, we set the `path` parameter to the desired file name, and we pass the manifest definition as the `content` parameter.

Document groups are used to organize documents. Documents in a group will be written into a folder
with the same name as the group. Documents in the same group will also be applied together, and they
will be deleted together when the package is removed.

Default file path of a document is its kind in lowercase concatenated with a hyphen and its metadata name. Here we override the default path to `pod.yaml` since this is the only pod in the package.

<CodeBlock language="javascript" title="my-package.js" showLineNumbers={50}>
    {PackageJs.split('\n').slice(28, 31).join('\n')}
</CodeBlock>

Lastly, we export the `add` function so that it can be used by users and Anemos.

## Using the Package

To use the package we just created, we can create another JavaScript file named `index.js` with the following content:

<Tabs>
  <TabItem value="index.js">
    <CodeBlock language="javascript" showLineNumbers>
      {IndexJs}
    </CodeBlock>
  </TabItem>

  <TabItem value="output/manifests/custom-app/pod.yaml">
    <CodeBlock language="yaml" showLineNumbers>
      {PodYaml}
    </CodeBlock>
  </TabItem>
</Tabs>

This code imports the Anemos library and our package, creates a `Builder` instance, adds our package to the builder with custom options, and finally builds the manifests.
